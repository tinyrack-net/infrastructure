apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: discourse-database-helm-release
  namespace: discourse-system
spec:
  chartRef:
    kind: OCIRepository
    name: postgres-repository
    namespace: flux-system
  interval: 5m
  timeout: 5m
  releaseName: discourse-database
  values:
    image:
      registry: docker.io
      repository: bitnami/postgresql
      tag: 13-debian-12
      pullPolicy: IfNotPresent
    auth:
      enablePostgresUser: true
      username: "discourse"
      database: "discourse"
      replicationUsername: discourse
      existingSecret: "discourse-database-secret"
      secretKeys:
        adminPasswordKey: postgres-password
        userPasswordKey: password
        replicationPasswordKey: replication-password
      usePasswordFiles: true
    architecture: standalone
    primary:
      name: primary
      service:
        type: ClusterIP
      persistence:
        enabled: true
        volumeName: "data"
        storageClass: "longhorn-strict-local"
        size: 3Gi
    readReplicas:
      name: read
      replicaCount: 0